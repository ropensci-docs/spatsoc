<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spatsoc">
<title>Using spatsoc in social network analysis - grouping functions • spatsoc</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using spatsoc in social network analysis - grouping functions">
<meta property="og:description" content="spatsoc">
<meta property="og:image" content="https://docs.ropensci.org/spatsoc/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">spatsoc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/intro-spatsoc.html">Introduction to spatsoc</a>
    <a class="dropdown-item" href="../articles/faq.html">Frequently asked questions</a>
    <a class="dropdown-item" href="../articles/using-in-sna.html">Using spatsoc in social network analysis</a>
    <a class="dropdown-item" href="../articles/using-edge-and-dyad.html">Using edge list and dyad id functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/additional-data-formats.html">Additional data formats</a>
    <a class="dropdown-item" href="../articles/faq.html">Frequently asked questions about spatsoc</a>
    <a class="dropdown-item" href="../articles/intro-spatsoc.html">Introduction to spatsoc</a>
    <a class="dropdown-item" href="../articles/using-edge-and-dyad.html">Using edge list generating functions and dyad_id</a>
    <a class="dropdown-item" href="../articles/using-in-sna.html">Using spatsoc in social network analysis - grouping functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/spatsoc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using spatsoc in social network analysis - grouping functions</h1>
                        <h4 data-toc-skip class="author">Alec Robitaille, Quinn Webber and Eric Vander Wal</h4>
            
            <h4 data-toc-skip class="date">2024-03-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/spatsoc/blob/HEAD/vignettes/using-in-sna.Rmd" class="external-link"><code>vignettes/using-in-sna.Rmd</code></a></small>
      <div class="d-none name"><code>using-in-sna.Rmd</code></div>
    </div>

    
    
<p><code>spatsoc</code> can be used in social network analysis to generate gambit of the group format data from GPS relocation data, perform data stream randomization and generate group by individual matrices.</p>
<p>Gambit of the group format data is generated using the grouping functions:</p>
<ul>
<li><code>group_times</code></li>
<li><code>group_pts</code></li>
<li><code>group_lines</code></li>
<li><code>group_polys</code></li>
</ul>
<p>Data stream randomization is performed using the <code>randomizations</code> function.</p>
<p>Group by individual matrices are generated using the <code>get_gbi</code> function.</p>
<p><strong>Note</strong>: edge list generating functions are also available and are described in the vignette <a href="https://docs.ropensci.org/spatsoc/articles/using-edge-and-dyad.html">Using edge list generating functions and dyad_id</a>.</p>
<div class="section level2">
<h2 id="generate-gambit-of-the-group-data">Generate gambit of the group data<a class="anchor" aria-label="anchor" href="#generate-gambit-of-the-group-data"></a>
</h2>
<p>spatsoc provides users with one temporal (<code>group_times</code>) and three spatial (<code>group_pts</code>, <code>group_lines</code>, <code>group_polys</code>) functions to generate gambit of the group data from GPS relocations. Users can consider spatial grouping at three different scales combined with an appropriate temporal grouping threshold. The gambit of the group data is then used to generate a group by individual matrix and build the network.</p>
<div class="section level3">
<h3 id="load-packages-and-prepare-data">1. Load packages and prepare data<a class="anchor" aria-label="anchor" href="#load-packages-and-prepare-data"></a>
</h3>
<p><code>spatsoc</code> expects a <code>data.table</code> for all <code>DT</code> arguments and date time columns to be formatted <code>POSIXct</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/spatsoc/">spatsoc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">asnipe</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Read data as a data.table</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"DT.csv"</span>, package <span class="op">=</span> <span class="st">"spatsoc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Cast datetime column to POSIXct</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">datetime</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Calculate the year of the relocation </span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">yr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Next, we will group relocations temporally with <code>group_times</code> and spatially with one of <code>group_pts</code>, <code>group_lines</code>, <code>group_polys</code>. Note: these are mutually exclusive, only select one spatial grouping function at a time.</p>
</div>
<div class="section level3">
<h3 id="a-group_pts">2. a) <code>group_pts</code><a class="anchor" aria-label="anchor" href="#a-group_pts"></a>
</h3>
<p>Point based grouping by calculating distance between relocations in each timegroup. Depending on species and study system, relevant temporal and spatial grouping thresholds are used. In this case, relocations within 5 minutes and 50 meters are grouped together.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Temporal groups</span></span>
<span><span class="fu"><a href="../reference/group_times.html">group_times</a></span><span class="op">(</span><span class="va">DT</span>, datetime <span class="op">=</span> <span class="st">'datetime'</span>, threshold <span class="op">=</span> <span class="st">'5 minutes'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Spatial groups</span></span>
<span><span class="fu"><a href="../reference/group_pts.html">group_pts</a></span><span class="op">(</span></span>
<span>  <span class="va">DT</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span>,</span>
<span>  timegroup <span class="op">=</span> <span class="st">'timegroup'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b-group_lines">2. b) <code>group_lines</code><a class="anchor" aria-label="anchor" href="#b-group_lines"></a>
</h3>
<p>Line based grouping by measuring intersection of, optionally buffered, trajectories for each individual in each timegroup. Longer temporal thresholds are used to measure, for example, intersecting daily trajectories.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># EPSG code for relocations</span></span>
<span><span class="va">utm</span> <span class="op">&lt;-</span> <span class="fl">32736</span></span>
<span></span>
<span><span class="co">## Group relocations by julian day</span></span>
<span><span class="fu"><a href="../reference/group_times.html">group_times</a></span><span class="op">(</span><span class="va">DT</span>, datetime <span class="op">=</span> <span class="st">'datetime'</span>, threshold <span class="op">=</span> <span class="st">'1 day'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Group lines for each individual and julian day</span></span>
<span><span class="fu"><a href="../reference/group_lines.html">group_lines</a></span><span class="op">(</span></span>
<span>  <span class="va">DT</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  projection <span class="op">=</span> <span class="va">utm</span>,</span>
<span>  id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span>,</span>
<span>  timegroup <span class="op">=</span> <span class="st">'timegroup'</span>,</span>
<span>  sortBy <span class="op">=</span> <span class="st">'datetime'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c-group_polys">2. c) <code>group_polys</code><a class="anchor" aria-label="anchor" href="#c-group_polys"></a>
</h3>
<p>Polygon based grouping by generating home ranges using <code>adehabitatHR</code> and measuring intersection or proportional overlap. Longer temporal thresholds are used to create seasonal, monthly, yearly home ranges.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># EPSG code for relocations</span></span>
<span><span class="va">utm</span> <span class="op">&lt;-</span> <span class="fl">32736</span></span>
<span></span>
<span><span class="co">## Option 1: area = FALSE and home range intersection 'group' column added to DT </span></span>
<span><span class="fu"><a href="../reference/group_polys.html">group_polys</a></span><span class="op">(</span></span>
<span>  <span class="va">DT</span>,</span>
<span>  area <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hrType <span class="op">=</span> <span class="st">'mcp'</span>,</span>
<span>  hrParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fl">95</span><span class="op">)</span>,</span>
<span>  projection <span class="op">=</span> <span class="va">utm</span>,</span>
<span>  id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Option 2: area = TRUE </span></span>
<span><span class="co">#  results must be assigned to a new variable </span></span>
<span><span class="co">#  data.table returned has ID1, ID2 and proportion and area overlap</span></span>
<span><span class="va">areaDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_polys.html">group_polys</a></span><span class="op">(</span></span>
<span>  <span class="va">DT</span>,</span>
<span>  area <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  hrType <span class="op">=</span> <span class="st">'mcp'</span>,</span>
<span>  hrParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fl">95</span><span class="op">)</span>,</span>
<span>  projection <span class="op">=</span> <span class="va">utm</span>,</span>
<span>  id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-observed-network">Build observed network<a class="anchor" aria-label="anchor" href="#build-observed-network"></a>
</h2>
<p>Once we’ve generated groups using <code>group_times</code> and one of the spatial grouping functions, we can generate a group by individual matrix.</p>
<p>The following code chunk showing <code>get_gbi</code> can be used for outputs from any of <code>group_pts</code>, <code>group_lines</code> or <code>group_polys(area = FALSE)</code>. For the purpose of this vignette however, we will consider the outputs from <code>group_pts</code> (<a href="#a-group_pts">2. a)</a>) for the following code chunk.</p>
<p>Note: we show this example creating the group by individual matrix and network for only 2016 to illustrate how <code>spatsoc</code> can be used for simpler data with no splitting of temporal or spatial subgroups (e.g.: yearly, population). See the random network section for how to use <code>spatsoc</code> in social network analysis for multi-year or other complex data.</p>
<div class="section level3">
<h3 id="get_gbi">3. <code>get_gbi</code><a class="anchor" aria-label="anchor" href="#get_gbi"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Subset DT to only year 2016</span></span>
<span><span class="va">subDT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">yr</span> <span class="op">==</span> <span class="fl">2016</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Generate group by individual matrix</span></span>
<span><span class="co"># group column generated by spatsoc::group_pts</span></span>
<span><span class="va">gbiMtrx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_gbi.html">get_gbi</a></span><span class="op">(</span>DT <span class="op">=</span> <span class="va">subDT</span>, group <span class="op">=</span> <span class="st">'group'</span>, id <span class="op">=</span> <span class="st">'ID'</span><span class="op">)</span></span></code></pre></div>
<p>Note: <code><a href="../reference/get_gbi.html">spatsoc::get_gbi</a></code> is identical in function to <code><a href="https://rdrr.io/pkg/asnipe/man/get_group_by_individual.html" class="external-link">asnipe::get_group_by_individual</a></code>, but is more efficient (some benchmarks measuring &gt;10x improvements) thanks to <code><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">data.table::dcast</a></code>.</p>
</div>
<div class="section level3">
<h3 id="asnipeget_network">4. <code>asnipe::get_network</code><a class="anchor" aria-label="anchor" href="#asnipeget_network"></a>
</h3>
<p>Next, we can use <code><a href="https://rdrr.io/pkg/asnipe/man/get_network.html" class="external-link">asnipe::get_network</a></code> to build the observed social network. Ensure that the argument “data_format” is “GBI”. Use other arguments that are relevant to your analysis, here we calculate a Simple ratio index.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate observed network</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asnipe/man/get_network.html" class="external-link">get_network</a></span><span class="op">(</span><span class="va">gbiMtrx</span>,</span>
<span>                   data_format <span class="op">=</span> <span class="st">"GBI"</span>,</span>
<span>                   association_index <span class="op">=</span> <span class="st">"SRI"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-stream-randomization">Data stream randomization<a class="anchor" aria-label="anchor" href="#data-stream-randomization"></a>
</h2>
<p>Three types of data stream randomization are provided by <code>spatsoc</code>’s <code>randomizations</code> function:</p>
<ul>
<li>step: randomizes identities of relocations between individuals within each time step.</li>
<li>daily: randomizes identities of relocations between individuals within each day.</li>
<li>trajectory: randomizes daily trajectories within individuals (<a href="https://doi.org/10.1111/2041-210X.12553" class="external-link">Spiegel et al. 2016</a>).</li>
</ul>
<p>The results of <code>randomizations</code> must be assigned. The function returns the <code>id</code> and <code>datetime</code> columns provided (and anything provided to <code>splitBy</code>). In addition, columns ‘observed’ and ‘iteration’ are returned indicating observed rows and which iteration rows correspond to (where 0 is the observed).</p>
<p>As with spatial grouping functions, these methods are mutually exclusive. Pick one <code>type</code> and rebuild the network after randomization.</p>
<p>Note: the <code>coords</code> argument is only required for trajectory type randomization, since after randomizing with this method, the ‘coords’ are needed to redo spatial grouping (with <code>group_pts</code>, <code>group_lines</code> or <code>group_polys</code>).</p>
<div class="section level3">
<h3 id="a-type-step">5. a) <code>type = 'step'</code><a class="anchor" aria-label="anchor" href="#a-type-step"></a>
</h3>
<p><code>'step'</code> randomizes identities of relocations between individuals within each time step. The <code>datetime</code> argument expects an integer group generated by <code>group_times</code>. The <code>group</code> argument expects the column name of the group generated from the spatial grouping functions.</p>
<p>Four columns are returned when <code>type = 'step'</code> along with <code>id</code>, <code>datetime</code> and <code>splitBy</code> columns:</p>
<ul>
<li>‘randomID’ - randomly selected ID from IDs within each time step</li>
<li>‘observed’ - observed rows (TRUE/FALSE)</li>
<li>‘iteration’ - which iteration rows correspond to (0 is observed)</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate year column to ensure randomization only occurs within years since data spans multiple years</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">yr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Step type randomizations</span></span>
<span><span class="co">#  providing 'timegroup' (from group_times) as datetime</span></span>
<span><span class="co">#  splitBy = 'yr' to force randomization only within year</span></span>
<span><span class="va">randStep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomizations.html">randomizations</a></span><span class="op">(</span></span>
<span>   <span class="va">DT</span>,</span>
<span>   type <span class="op">=</span> <span class="st">'step'</span>,</span>
<span>   id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>   group <span class="op">=</span> <span class="st">'group'</span>,</span>
<span>   coords <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>   datetime <span class="op">=</span> <span class="st">'timegroup'</span>,</span>
<span>   iterations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>   splitBy <span class="op">=</span> <span class="st">'yr'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b-type-daily">5. b) <code>type = 'daily'</code><a class="anchor" aria-label="anchor" href="#b-type-daily"></a>
</h3>
<p><code>'daily'</code> randomizes identities of relocations between individuals within each day. The <code>datetime</code> argument expects a datetime <code>POSIXct</code> format column.</p>
<p>Four columns are returned when <code>type = 'daily'</code> along with <code>id</code>, <code>datetime</code> and <code>splitBy</code> columns:</p>
<ul>
<li>‘randomID’ - randomly selected ID for each day</li>
<li>‘jul’ - julian day</li>
<li>‘observed’ - observed rows (TRUE/FALSE)</li>
<li>‘iteration’ - which iteration rows correspond to (0 is observed)</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate year column to ensure randomization only occurs within years since data spans multiple years</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">yr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Daily type randomizations</span></span>
<span><span class="co"># splitBy = 'yr' to force randomization only within year</span></span>
<span><span class="va">randDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomizations.html">randomizations</a></span><span class="op">(</span></span>
<span>   <span class="va">DT</span>,</span>
<span>   type <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>   id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>   group <span class="op">=</span> <span class="st">'group'</span>,</span>
<span>   coords <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>   datetime <span class="op">=</span> <span class="st">'datetime'</span>,</span>
<span>   splitBy <span class="op">=</span> <span class="st">'yr'</span>,</span>
<span>   iterations <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c-type-trajectory">5. c) <code>type = 'trajectory'</code><a class="anchor" aria-label="anchor" href="#c-type-trajectory"></a>
</h3>
<p><code>'trajectory'</code> randomizes daily trajectories within individuals (<a href="https://doi.org/10.1111/2041-210X.12553" class="external-link">Spiegel et al. 2016</a>). The <code>datetime</code> argument expects a datetime <code>POSIXct</code> format column.</p>
<p>Five columns are returned when <code>type = 'trajectory'</code> along with <code>id</code>, <code>datetime</code> and <code>splitBy</code> columns:</p>
<ul>
<li>random date time (“random” prefixed to <em>datetime</em> argument)</li>
<li>‘jul’ - observed julian day</li>
<li>‘observed’ - observed rows (TRUE/FALSE)</li>
<li>‘iteration’ - which iteration rows correspond to (0 is observed)</li>
<li>‘randomJul’ - random julian day relocations are swapped to from observed julian day</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate year column to ensure randomization only occurs within years since data spans multiple years</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">yr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Trajectory type randomization</span></span>
<span><span class="va">randTraj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomizations.html">randomizations</a></span><span class="op">(</span></span>
<span>   <span class="va">DT</span>,</span>
<span>   type <span class="op">=</span> <span class="st">'trajectory'</span>,</span>
<span>   id <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>   group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span>,</span>
<span>   datetime <span class="op">=</span> <span class="st">'datetime'</span>,</span>
<span>   splitBy <span class="op">=</span> <span class="st">'yr'</span>,</span>
<span>   iterations <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-random-network">Build random network<a class="anchor" aria-label="anchor" href="#build-random-network"></a>
</h2>
<p>Once we’ve randomized the data stream with <code>randomizations</code>, we can build the random network.</p>
<p>We will use the <code>get_gbi</code> function directly when <code>type</code> is either ‘step’ or ‘daily’. For <code>type = 'trajectory'</code>, we will recalculate spatial groups with one of <code>group_pts</code>, <code>group_lines</code>, <code>group_polys</code> for the randomized data. In this case, the example shows <code>group_pts</code>.</p>
<p>Since we want to create a group by individual matrix for each random iteration (and in this case, each year), we will use <code>mapply</code> to work on subsets of the randomized data.</p>
<p>Note: building the random networks depends on the <code>type</code> used and therefore, the following chunks are mutually exclusive. Use the one that corresponds to the randomization type you used above.</p>
<div class="section level3">
<h3 id="a-type-step-1">6. a) <code>type = 'step'</code><a class="anchor" aria-label="anchor" href="#a-type-step-1"></a>
</h3>
<p><code>randomizations</code> with <code>type = 'step'</code> returns a ‘randomID’ which should be used instead of the observed ‘ID’ to generate the group by individual matrix.</p>
<p>After <code>get_gbi</code>, we use <code><a href="https://rdrr.io/pkg/asnipe/man/get_network.html" class="external-link">asnipe::get_network</a></code> to build the random network.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a data.table of unique combinations of iteration and year, excluding observed rows</span></span>
<span><span class="va">iterYearLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">iteration</span>, <span class="va">yr</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate group by individual matrix </span></span>
<span><span class="co"># for each combination of iteration number and year</span></span>
<span><span class="co"># 'group' generated by spatsoc::group_pts</span></span>
<span><span class="co"># 'randomID' used instead of observed ID (type = 'step')</span></span>
<span><span class="va">gbiLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_gbi.html">get_gbi</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span><span class="va">iteration</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="va">yr</span> <span class="op">==</span> <span class="va">y</span><span class="op">]</span>,</span>
<span>          <span class="st">'group'</span>, <span class="st">'randomID'</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  i <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span>,</span>
<span>  y <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate a list of random networks</span></span>
<span><span class="va">netLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gbiLs</span>, FUN <span class="op">=</span> <span class="va">get_network</span>,</span>
<span>                data_format <span class="op">=</span> <span class="st">"GBI"</span>, association_index <span class="op">=</span> <span class="st">"SRI"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b-type-daily-1">6. b) <code>type = 'daily'</code><a class="anchor" aria-label="anchor" href="#b-type-daily-1"></a>
</h3>
<p><code>randomizations</code> with <code>type = 'step'</code> returns a ‘randomID’ which should be used instead of the observed ‘ID’ to generate the group by individual matrix.</p>
<p>After <code>get_gbi</code>, we use <code><a href="https://rdrr.io/pkg/asnipe/man/get_network.html" class="external-link">asnipe::get_network</a></code> to build the random network.</p>
<p>In this case, we will generate a fake column representing a “population” to show how we can translate the <code>mapply</code> chunk above to three (or more variables).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate fake population</span></span>
<span><span class="va">randDaily</span><span class="op">[</span>, <span class="va">population</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">.N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Create a data.table of unique combinations of iteration, year, and population, excluding observed rows</span></span>
<span><span class="va">iterYearLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">iteration</span>, <span class="va">yr</span>, <span class="va">population</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate group by individual matrix </span></span>
<span><span class="co"># for each combination of iteration number and year</span></span>
<span><span class="co"># 'group' generated by spatsoc::group_pts</span></span>
<span><span class="co"># 'randomID' used instead of observed ID (type = 'step')</span></span>
<span><span class="va">gbiLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">y</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_gbi.html">get_gbi</a></span><span class="op">(</span><span class="va">randDaily</span><span class="op">[</span><span class="va">iteration</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">yr</span> <span class="op">==</span> <span class="va">y</span> <span class="op">&amp;</span> <span class="va">population</span> <span class="op">==</span> <span class="va">p</span><span class="op">]</span>,</span>
<span>          <span class="st">'group'</span>, <span class="st">'randomID'</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  i <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span>,</span>
<span>  y <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span>,</span>
<span>  p <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate a list of random networks</span></span>
<span><span class="va">netLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gbiLs</span>, FUN <span class="op">=</span> <span class="va">get_network</span>,</span>
<span>                data_format <span class="op">=</span> <span class="st">"GBI"</span>, association_index <span class="op">=</span> <span class="st">"SRI"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c-type-trajectory-1">6. c) <code>type = 'trajectory'</code><a class="anchor" aria-label="anchor" href="#c-type-trajectory-1"></a>
</h3>
<p><code>randomizations</code> with <code>type = 'trajectory'</code> returns a random date time which should be used instead of the observed date time to generate random gambit of the group data.</p>
<p>First, we pass the randomized data to <code>group_times</code> using the random date time for <code>datetime</code>.</p>
<p>After <code>get_gbi</code>, we use <code><a href="https://rdrr.io/pkg/asnipe/man/get_network.html" class="external-link">asnipe::get_network</a></code> to build the random network.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Randomized temporal groups</span></span>
<span><span class="co"># 'datetime' is the randomdatetime produced by randomizations(type = 'trajectory')</span></span>
<span><span class="fu"><a href="../reference/group_times.html">group_times</a></span><span class="op">(</span><span class="va">randTraj</span>, datetime <span class="op">=</span> <span class="st">'randomdatetime'</span>, threshold <span class="op">=</span> <span class="st">'5 minutes'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Randomized spatial groups</span></span>
<span><span class="co"># 'iteration' used in splitBy to ensure only points within each iteration are grouped</span></span>
<span><span class="fu"><a href="../reference/group_pts.html">group_pts</a></span><span class="op">(</span><span class="va">randTraj</span>, threshold <span class="op">=</span> <span class="fl">50</span>, id <span class="op">=</span> <span class="st">'ID'</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="st">'Y'</span><span class="op">)</span>,</span>
<span>          timegroup <span class="op">=</span> <span class="st">'timegroup'</span>, splitBy <span class="op">=</span> <span class="st">'iteration'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a data.table of unique combinations of iteration and year, excluding observed rows</span></span>
<span><span class="va">iterYearLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">iteration</span>, <span class="va">yr</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate group by individual matrix </span></span>
<span><span class="co"># for each combination of iteration number and year</span></span>
<span><span class="co"># 'group' generated by spatsoc::group_pts</span></span>
<span><span class="co"># 'ID' used since datetimes were randomized within individuals</span></span>
<span><span class="va">gbiLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_gbi.html">get_gbi</a></span><span class="op">(</span><span class="va">randTraj</span><span class="op">[</span><span class="va">iteration</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="va">yr</span> <span class="op">==</span> <span class="va">y</span><span class="op">]</span>,</span>
<span>          <span class="st">'group'</span>, <span class="st">'ID'</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  i <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span>,</span>
<span>  y <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate a list of random networks</span></span>
<span><span class="va">netLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gbiLs</span>, FUN <span class="op">=</span> <span class="va">get_network</span>,</span>
<span>                data_format <span class="op">=</span> <span class="st">"GBI"</span>, association_index <span class="op">=</span> <span class="st">"SRI"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="network-metrics">Network metrics<a class="anchor" aria-label="anchor" href="#network-metrics"></a>
</h2>
<p>Finally, we can calculate some network metrics. Please note that there are many ways of interpreting, analyzing and measuring networks, so this will simply show one option.</p>
<div class="section level3">
<h3 id="calculate-observed-network-metrics">7. Calculate observed network metrics<a class="anchor" aria-label="anchor" href="#calculate-observed-network-metrics"></a>
</h3>
<p>To calculate observed network metrics, use the network (<code>net</code>) produced in <a href="#asnipeget_network">4.</a> from 2016 data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate graph</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.adjacency.html" class="external-link">graph.adjacency</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">'undirected'</span>, </span>
<span>                     diag <span class="op">=</span> <span class="cn">FALSE</span>, weighted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Metrics for all individuals </span></span>
<span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  centrality <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/evcent.html" class="external-link">evcent</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>,</span>
<span>  strength <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.strength.html" class="external-link">graph.strength</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span>
<span>  degree <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  yr <span class="op">=</span> <span class="va">subDT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">yr</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-random-network-metrics">8. Calculate random network metrics<a class="anchor" aria-label="anchor" href="#calculate-random-network-metrics"></a>
</h3>
<p>With the list of random networks from <a href="#build-random-network">6.</a>, we can generate a list of graphs with <code><a href="https://r.igraph.org/reference/graph.adjacency.html" class="external-link">igraph::graph.adjacency</a></code> (for example) and calculate random network metrics.</p>
<p>This example uses the <code>netLs</code> generated by <a href="#a-type-step-1">6. a)</a> which was split by year and iteration.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate graph and calculate network metrics</span></span>
<span><span class="va">mets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">netLs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.adjacency.html" class="external-link">graph.adjacency</a></span><span class="op">(</span><span class="va">netLs</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>, <span class="st">'undirected'</span>, </span>
<span>                       diag <span class="op">=</span> <span class="cn">FALSE</span>, weighted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    centrality <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/evcent.html" class="external-link">evcent</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>,</span>
<span>    strength <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.strength.html" class="external-link">graph.strength</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span>
<span>    degree <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span>
<span>    ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    iteration <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    yr <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Metrics for all individuals across all iterations and years</span></span>
<span><span class="va">random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">mets</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Mean values for each individual and year</span></span>
<span><span class="va">meanMets</span> <span class="op">&lt;-</span> <span class="va">random</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">yr</span><span class="op">)</span>,</span>
<span>                .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'centrality'</span>, <span class="st">'strength'</span>, <span class="st">'degree'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-observed-and-random-metrics">9. Compare observed and random metrics<a class="anchor" aria-label="anchor" href="#compare-observed-and-random-metrics"></a>
</h3>
<p>Instead of calculating observed and random metrics separately (shown in <a href="#calculate-observed-network-metrics">7.</a> and <a href="#calculate-random-network-metrics">8.</a>), we can calculate metrics for both at the same time and compare.</p>
<p>This chunk expects the outputs from <a href="#a-type-step">5. a)</a>, skipping steps 6.-8.</p>
<p>Note: by removing the <code>!(observed)</code> subset from <code>randStep</code> performed in <a href="#a-type-step-1">6. a)</a>, we will include observed rows where <code>iteration == 0</code>. This will return a <code>gbiLs</code> where the observed and random rows are included in the same <code>data.table</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a data.table of unique combinations of iteration and year, including observed and random rows</span></span>
<span><span class="va">iterYearLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">iteration</span>, <span class="va">yr</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate group by individual matrix </span></span>
<span><span class="co"># for each combination of iteration and year</span></span>
<span><span class="co"># 'group' generated by spatsoc::group_pts</span></span>
<span><span class="co"># 'randomID' used instead of observed ID (type = 'step')</span></span>
<span><span class="va">gbiLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_gbi.html">get_gbi</a></span><span class="op">(</span><span class="va">randStep</span><span class="op">[</span><span class="va">iteration</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="va">yr</span> <span class="op">==</span> <span class="va">y</span><span class="op">]</span>,</span>
<span>          <span class="st">'group'</span>, <span class="st">'randomID'</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  i <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span>,</span>
<span>  y <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate a list of random networks</span></span>
<span><span class="va">netLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gbiLs</span>, FUN <span class="op">=</span> <span class="va">get_network</span>,</span>
<span>                data_format <span class="op">=</span> <span class="st">"GBI"</span>, association_index <span class="op">=</span> <span class="st">"SRI"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate graph and calculate network metrics</span></span>
<span><span class="va">mets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">netLs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.adjacency.html" class="external-link">graph.adjacency</a></span><span class="op">(</span><span class="va">netLs</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>, <span class="st">'undirected'</span>, </span>
<span>                       diag <span class="op">=</span> <span class="cn">FALSE</span>, weighted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    centrality <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/evcent.html" class="external-link">evcent</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>,</span>
<span>    strength <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.strength.html" class="external-link">graph.strength</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span>
<span>    ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    iteration <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">iter</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    yr <span class="op">=</span> <span class="va">iterYearLs</span><span class="op">$</span><span class="va">yr</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Observed and random for all individuals across all iterations and years</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">mets</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Split observed and random</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="va">observed</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">iteration</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Mean values for each individual and year, by observed/random</span></span>
<span><span class="va">meanMets</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">yr</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'centrality'</span>, <span class="st">'strength'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
